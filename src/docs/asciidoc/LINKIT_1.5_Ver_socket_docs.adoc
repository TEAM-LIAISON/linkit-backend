= 실시간 채팅/알림 API 명세서
:doctype: book
:icons: font
:toc: left
:source-highlighter: highlightjs
:sectnums:
:sectlinks:

[[notification-websocket]]
== 웹소켓 활용 채팅 및 알림 기능

=== 웹소켓 연결

[cols="2,5"]
|===
| 웹소켓 연결 URL | wss://dev.liaison-dev.site/stomp/linkit
| 프로토콜 | STOMP over WebSocket
|===

[source,http]
----
Authorization: Bearer {accessToken}
----

[source,json]
----
{
    "Authorization": "Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOiIxIiwiaWF0IjoxNzM2Mzk3OTE0LCJleHAiOjE3MzY0MDE1MTR9.ax6k9jeG4rTJmOP9fhebYRd50Ahmj7s9UtMegBhPEIY"
}
----

=== 채팅방 구독 연결 (/sub)

[source,http]
----
Authorization: Bearer {accessToken}
----

==== 채팅방 구독

[source,http]
----
SUBSCRIBE /sub/chat/{chatRoomId}
----

==== 채팅방 읽기/안읽기 상태 구독

[source,http]
----
SUBSCRIBE /sub/chat/read/{chatRoomId}
----

=== 채팅 메시지 전송 (/pub)

[source,http]
----
Authorization: Bearer {accessToken}
----

==== 채팅 메시지 전송

[source,http]
----
SEND /pub/chat/send/{chatRoomId}
----

=== 상단바 구독 연결 (/sub)

[source,http]
----
Authorization: Bearer {accessToken}
----

==== 상단바 신규 채팅/신규 알림 정보 구독 (빨간점 표시)

이 구독 경로를 통해, 새로 온 채팅 메시지나 알림의 미확인(안 읽음) 개수를 실시간으로 받아볼 수 있습니다.

[source,http]
----
SUBSCRIBE /sub/notification/header/{emailId}
----

**Path Parameter**
- `emailId`: 이메일 ID (문자열)

구독 성공 시, 서버에서 `NotificationCountResponse` 형태의 메시지가 다음과 같이 전송됩니다:

==== NotificationCountResponse

[cols="1,1,4",options="header"]
|===
|필드명 |타입 |설명

|unreadChatCount |int
|안 읽은 채팅 메시지의 개수

|unreadNotificationCount |int
|안 읽은 알림의 개수
|===

==== Example Payload

아래는 실제로 전송되는 JSON 예시입니다.

[source,json]
----
{
  "unreadChatCount": 3,
  "unreadNotificationCount": 2
}
----
